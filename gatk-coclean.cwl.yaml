class: Workflow
label: GATK Co-Cleaning
cwlVersion: v1.0

inputs:
  tumor_bam:
    type: File
    secondaryFiles:
      - .bai

  normal_bam:
    type: File
    secondaryFiles:
      - .bai

  knownIndels:
    type:
      - "null"
      - type: array
        items: File

  knownSites:
    type:
      - "null"
      - File

  reference:
    type: File
    secondaryFiles:
      - .fai
      - .dict

outputs:
  cleaned_tumor_bam:
    type: File
    outputsource: printreads_tumor/output
    secondaryFiles:
      - .bai

  cleaned_normal_bam:
    type: File
    outputsource: printreads_normal/output
    secondaryFiles:
      - .bai

steps:
  - id: indel_realign
    run: ./indel_realign.cwl.yaml
    in:
      tumor_bam: tumor_bam
      normal_bam: tumor_bam
      reference: reference
      knownIndels: null
      parallel_realign: true
      out:
        - tumor_realigned
        - normal_realigned

  - id: bqsr_tumor
    run: ./gatk_bqsr.cwl.yaml
    in:
      input_bam: indel_realign/realigned_tumor
      reference: reference
      knownSites: null
      out:
        - output_report
          
  - id: printreads_tumor
    run: ./gatk_printreads.cwl.yaml
    in: 
      input_bam: indel_realign/realigned_tumor
      reference: reference
      emit_oq: false
      bqsr: bwsr/output_report
    out:
      - output

  - id: bqsr_normal
    run: ./gatk_bqsr.cwl.yaml
    in:
      input_bam: indel_realign/realigned_normal
      reference: reference
      knownSites: null
      out:
        - output_report
          
  - id: printreads_normal
    run: ./gatk_printreads.cwl.yaml
    in: 
      input_bam: indel_realign/realigned_normal
      reference: reference
      emit_oq: false
      bqsr: bwsr/output_report
    out:
      - output
