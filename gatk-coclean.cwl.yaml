class: Workflow
label: GATK Co-Cleaning
cwlVersion: v1.0

inputs:
  input_bam:
    type: File
    secondaryFiles:
      - .bai

  knownIndels:
    type:
      - "null"
      - type: array
        items: File

  knownSites:
    type:
      - "null"
      - File

  reference:
    type: File
    secondaryFiles:
      - .fai
      - .dict

outputs:
  cleaned_bam:
    type: File
    outputsource: printreads/output
    secondaryFiles:
      - .bai

steps:
  indel_realign:
    run: ./indel_realign.cwl.yaml
    in:
      input_bam: input_bam
      reference: reference
      knownIndels: null
      parallel_realign: true
    out:
      - realigned

  bqsr:
    run: ./gatk_bqsr.cwl.yaml
    in:
      input_bam: indel_realign/realigned
      reference: reference
      knownSites: null
    out:
      - output_report

  printreads:
    run: ./gatk_printreads.cwl.yaml
    in: 
      input_bam: indel_realign/realigned
      reference: reference
      emit_oq: false
      bqsr: bwsr/output_report
    out:
      - output
