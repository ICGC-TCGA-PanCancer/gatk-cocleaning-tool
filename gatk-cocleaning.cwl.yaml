class: Workflow
cwlVersion: v1.0
label: GATK Co-Cleaning Workflow

inputs:
  tumor_bam:
    type: File

  tumor_bai:
    type: File

  normal_bam:
    type: File

  normal_bai:
    type: File

  reference:
    type: File

  reference_fai:
    type: File

  reference_dict:
    type: File

  knownIndels:
    type:
      - "null"
      - type: array
        items: File

  knownSites:
    type: ["null", File]

  parallel_realign:
    type: ["null", boolean]

  emit_oq:
    type: ["null", boolean]
    
outputs:
  cleaned_tumor_bam:
    type: File
    outputSource: printreads_tumor/bam

  cleaned_tumor_bai:
    type: File
    outputSource: printreads_tumor/bai

  cleaned_normal_bam:
    type: File
    outputSource: printreads_normal/bam

  cleaned_normal_bai:
    type: File
    outputSource: printreads_normal/bai

steps:
  indel_realign:
    run: gatk-indelrealign.cwl.yaml
    in:
      tumor_bam: tumor_bam
      tumor_bai: tumor_bai
      normal_bam: normal_bam
      normal_bai: normal_bai
      reference: reference
      reference_fai: reference_fai
      reference_dict: reference_dict
      knownIndels: knownIndels
      parallel_realign: parallel_realign
    out:
      - tumor_realigned_bam
      - tumor_realigned_bai
      - normal_realigned_bam
      - normal_realigned_bai

  bqsr_tumor:
    run: gatk-bqsr.cwl.yaml
    in:
      input_bam: indel_realign/tumor_realigned_bam
      input_bai: indel_realign/tumor_realigned_bai
      reference: reference
      reference_fai: reference_fai
      reference_dict: reference_dict
      knownSites: knownSites
    out:
      - output_report
          
  printreads_tumor:
    run: gatk-printreads.cwl.yaml
    in: 
      input_bam: indel_realign/tumor_realigned_bam
      input_bai: indel_realign/tumor_realigned_bai
      reference: reference
      reference_fai: reference_fai
      reference_dict: reference_dict
      emit_oq: emit_oq
      bqsr: bqsr_tumor/output_report
    out:
      - bam
      - bai

  bqsr_normal:
    run: gatk-bqsr.cwl.yaml
    in:
      input_bam: indel_realign/normal_realigned_bam
      input_bai: indel_realign/normal_realigned_bai
      reference: reference
      reference_fai: reference_fai
      reference_dict: reference_dict
      knownSites: knownSites
    out:
      - output_report
          
  printreads_normal:
    run: gatk-printreads.cwl.yaml
    in: 
      input_bam: indel_realign/normal_realigned_bam
      input_bai: indel_realign/normal_realigned_bai
      reference: reference
      reference_fai: reference_fai
      reference_dict: reference_dict
      emit_oq: emit_oq
      bqsr: bqsr_normal/output_report
    out:
      - bam
      - bai
